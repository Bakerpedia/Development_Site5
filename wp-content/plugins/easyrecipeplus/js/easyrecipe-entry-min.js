/*! EasyRecipe Plus 3.3.3077 Copyright (c) 2015 BoxHill LLC */
window.EASYRECIPE=window.EASYRECIPE||{},EASYRECIPE.widget=EASYRECIPE.widget||jQuery.widget,EASYRECIPE.button=EASYRECIPE.button||jQuery.fn.button,function(e){function i(e,i){var t;switch(He.show(),yi.hide(),je.show(),t=i.newTab?i.newTab.index():i.index){case 0:yi.css("right","10px"),yi.show();break;case 3:yi.css("right","inherit"),je.hide(),yi.show();break;case 4:He.hide()}}function t(){Ii.off("change",t),ht=!0}function n(e){return e?(e+="",e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&nbsp;/g," ")):""}function a(i){return i?e("<div />").text(i).html():""}function r(i){return e.trim(a(i.val()))||!1}function s(e,i){var t=De.tabs("option","active");De.tabs("option","active",++t)}function o(e){var i,t=/\[img +(.*?) *\/?]/i,n=/\[url ([^\]]+)](.*?\[\/url])/i;for(i=t.exec(e);null!==i;)Yi.push(i[1]),e=e.replace(t,"[img:"+Yi.length+"]"),i=t.exec(e);for(i=n.exec(e);null!==i;)Wi.push(i[1]),e=e.replace(n,"[url:"+Wi.length+"]$2"),i=n.exec(e);return e}function l(e){var i,t,n=/\[img:(\d+)]/i,a=/\[url:(\d+)](.*?)\[\/url]/i;for(t=n.exec(e);null!==t;)i=Yi[t[1]-1],e=e.replace(n,"[img "+i+"]"),t=n.exec(e);for(t=a.exec(e);null!==t;)i=Wi[t[1]-1],e=e.replace(a,"[url "+i+"]$2[/url]"),t=a.exec(e);return e}function c(e,i){var t,n,a,r,s,o,l,d,p,u,h,v,f,g,m,y,E,R,b,w,C,I,T,S,N,x=0,k=1,U=2,_=0,A="",P="<!-- START REPEAT ",L="<!-- START INCLUDEIF ",O="<!-- END INCLUDEIF ";for(t=e,i=i||{};;){if(s=t.length,o=t.indexOf("#",_),-1!==o&&(s=o,l=x),d=t.indexOf(P,_),-1!==d&&s>d&&(s=d,l=k),p=t.indexOf(L,_),-1!==p&&s>p&&(s=p,l=U),s===t.length)return A+t.substr(_);switch(u=s-_,A+=t.substr(_,u),_=s,l){case U:if(a=t.substr(_,44),r=xi.exec(a),null===r)break;if(h=r[1],v="!"!==h,f=r[2],g=O+h+f+" -->",m=g.length,y=t.indexOf(g),-1===y){_++;break}E=typeof i[f]!==nt&&i[f]!==!1,E===v?(R="<!-- START INCLUDEIF "+h+f+" -->",b=R.length,t=t.substr(0,_)+t.substr(_+b,y-_-b)+t.substr(y+m)):t=t.substr(0,_)+t.substr(y+m);break;case x:if(a=t.substr(_,22),r=ki.exec(a),null===r){A+="#",_++;continue}if(w=r[1],""!==i[w]&&!i[w]){A+="#"+w+"#",_+=w.length+2;continue}A+=i[w],_+=w.length+2;break;case k:if(a=t.substr(_,45),r=Ui.exec(a),null===r){A+="<",_++;continue}if(C=r[1],!(i[C]&&i[C]instanceof Array)){A+="<",_++;continue}if(_+=C.length+22,I=t.indexOf("<!-- END REPEAT "+C+" -->",_),-1===I){A+="<!-- START REPEAT "+C+" -->";continue}for(T=I-_,S=t.substr(_,T),N=i[C],n=0;n<N.length;n++)A+=c(S,N[n]);_+=C.length+T+20}}}function d(i){var t,n,a=e.trim(i.val()),r=0,s=0;if(ue.hide(),""===a)return!0;if(Me=Ai.exec(a),null===Me){if(Me=Pi.exec(a),null===Me)return ue.show(),!1;r=0,s=Me[1]}else r=Me[1]?parseInt(Me[1],10):0,s=Me[2]?parseInt(Me[2],10):0;return 0===r&&0===s?i.val(""):(t=r>0?r+" hour":"",r>1&&(t+="s"),n=s>0?s+" min":"",s>1&&(n+="s"),i.val(e.trim(t+" "+n))),!0}function p(i){var t,n,a,r="";for(t=0;t<i.length;t++)n=i[t],3!==n.nodeType?1===n.nodeType&&n.childNodes.length>0&&(r+=p(n.childNodes)):(a=e.trim(n.nodeValue),""!==a&&(r+=a+"\n"));return r}function u(){var i;if(e(Ji,Zi).remove(),i=K.selection.getNode(),"#document"===i.nodeName&&(i=Le[0]),"BODY"===i.nodeName.toUpperCase())e(i).hasClass("mceContentBody")||(i=Le[0]),e(i).append("&nbsp;"+Gi);else{for(;i.parentNode&&"BODY"!==i.parentNode.nodeName.toUpperCase();)i=i.parentNode;i.parentNode?"DIV"===i.nodeName.toUpperCase()||"SPAN"===i.nodeName.toUpperCase()?e(i,Zi).after(Gi):e(i,Zi).before(Gi):(i=Le[0],e(i).append("&nbsp;"+Gi))}return hi=-1,e(Ji,Zi)}function h(e,i,t){}function v(i){switch(i.type){case"js":e("head").append(e('<script type="text/javascript">'+i.js+"</script>")),xe[i.f]();break;case"html":e(i.dest).html(i.html)}}function f(){Be.unbind(tt),Ve.unbind(tt),Pe.dialog(it),Ni=!0,be()}function g(i,t){var a,r,s,o="";for(r=i.recipe,"success"!==t&&(Pe.dialog(it),Ni=!0,be()),ee.val(n(r.recipe_title)),r.rating&&e.isNumeric(r.rating)&&X.val(r.rating),dt=r.recipe_image,ce.val(""),le.val(r.author?n(r.author):""),de.val(r.cuisine||""),ce.val(r.mealType||""),pe.val(""),ie.val(n(r.summary)),Me=Di.exec(r.prep_time),null!==Me?(a=Me[1]?Me[1]+"h ":"",ae.val(a+Me[2]+"m")):ae.val(n(r.prep_time)),Me=Di.exec(r.cook_time),null!==Me?(a=Me[1]?Me[1]+"h ":"",re.val(a+Me[2]+"m")):re.val(n(r.cook_time)),se.val(n(r["yield"])),Xe.val(n(r.serving_size)),r.nutrition?(s=r.nutrition,ei.val(n(s.calories)),ii.val(n(s.totalFat)),ti.val(n(s.saturatedFat)),ni.val(n(s.unsaturatedFat)),ai.val(n(s.transFat)),ri.val(n(s.totalCarbohydrates)),si.val(n(s.sugars)),oi.val(n(s.sodium)),li.val(n(s.dietaryFiber)),ci.val(n(s.protein)),di.val(n(s.cholesterol))):(ei.val(n(r.calories)),ii.val(n(r.fat))),a=0;a<i.ingredients.length;a++)o+=Si(n(i.ingredients[a]))+"\n";te.val(o),ne.val(n(r.instructions.replace("\r",""))),pi.val(n(r.notes)),Ue.dialog("option","title","Update Recipe"),Pe.dialog(it),$e.hide(),Ge.show(),We.hide(),""!==dt&&wi(dt,ze.length,!0),fe=u(),Ue.parent(".ui-dialog").css(qi,Oe),Ue.dialog(Ki,qi,Oe),Ue.dialog(at)}function m(){var i;Ye.show(),Be.unbind(tt),Ve.unbind(tt),i={action:"easyrecipeConvert",id:Ee,type:Re},e.post(ajaxurl,i,g,"json")}function y(i){var t,n,a,r,s,o,l,c,d,u,h,v,f,g=0,m="",y="",E="",R="",b=["instruction","method","cooking method","procedure","direction"],w=["ingredients?"],C=["note","cooking note"];for(h=e.parseJSON(xe.ingredients),v=e.parseJSON(xe.instructions),f=e.parseJSON(xe.notes),-1===e.inArray(h,w)&&w.push(h),o="^\\s*(?:"+w.join("|")+")",d=new RegExp(o,"i"),-1===e.inArray(v,b)&&w.push(v),s="^\\s*(?:"+b.join("|")+")",c=new RegExp(s,"i"),-1===e.inArray(f,C)&&C.push(f),l="^\\s*(?:"+C.join("|")+")\\s*$",u=new RegExp(l,"i"),r=e("<div>"+i+"</div>"),t=p(r[0].childNodes),t=t.split("\n"),n=0;n<t.length;n++)if(a=e.trim(t[n]),""!==a)if(c.test(a))g=2;else if(d.test(a))g=1;else if(u.test(a))g=3;else switch(g){case 0:m+=a+"\n";break;case 1:y+=a+"\n";break;case 2:E+=a+"\n";break;case 3:R+=a+"\n"}return{summary:m,ingredients:y,instructions:E,notes:R}}function E(i){var t,n=e(".easyrecipe",Zi),a=e("#divERSELRecipes").find("ul");a.empty(),n.each(function(n){t=e(".ERName",this).text(),""===t&&(t="Recipe "+(n+1)),a.append(e("<li>"+t+"</li>").click(function(){Ae.dialog(it),we(i,n)}))}),Ae.parent(".ui-dialog").css(qi,Oe),Ae.dialog(Ki,qi,Oe),Ae.dialog(at)}function R(i,t,n){var a,r=function(){var i,t,n,a,r=e.data(this,"index");i=this.width/150,t=this.height/112,i=i>t?i:t,n=Math.floor(this.height/i),a=Math.floor(this.width/i),ze[r].height(n),ze[r].width(a),ze[r].css("top",(112-n)/2),ze[r].attr("src",this.src),0===r&&e("#ERDTabs").find(".divERNoPhotos").remove()};Fe.append('<div class="ERPhoto"><img style="position:relative" id="ERPhoto_'+t+'" /></div>'),ze[t]=e("#ERPhoto_"+t,Fe),ze[t].data("src",i),n&&(e(".ERPhoto",Fe).removeClass(rt),ze[t].parent().addClass(rt),gi=t,dt=i),""===Ri&&(Ri=i),a=new Image,e.data(a,"index",t),a.onload=r,a.src=i}function b(){R(fi.val(),ze.length,!0),fi.val(""),vi.hide(),e(".divERNoPhotos").remove()}function w(e,i){var t,n=!1;for(t=0;t<ze.length;t++)if(ze[t].data("src")===e){n=!0;break}n||R(e,ze.length,i)}function C(i,a){var r,s,l,c,d,p,g,b,C,I,T,S,N,x,k,U,_,A,P={},L="",O="",M="",D="";if(!i||1===i.which){if(i&&i.data===ct&&(a=ct,i=i.delegateTarget),typeof a===nt&&Xi>1)return Xi=e(".easyrecipe",Zi).length,void E(i);if(fe=e(".easyrecipe",Zi),a===ct){for(g=0;g<fe.length;g++)if(fe[g]===i){hi=g;break}fe=e(i)}if(typeof a===nt&&typeof i===nt&&(hi=0),a!==lt&&fe.length>1&&(fe=e(fe[a]),hi=a),s=0,s=1,S=e.support.cors?"json":"jsonp",e.ajax(st,{dataType:S,data:{v:xe.version,p:s,u:xe.wpurl},success:v,error:h}),q=!1,typeof tinyMCE!==nt&&tinyMCE.activeEditor&&!tinyMCE.activeEditor.isHidden()&&(q=!0),!q)return void alert("You must use the Visual Editor to add or update an EasyRecipe");if(ee.val(""),ce.val(""),de.val(""),pe.val(""),le.val(""),ie.val(""),ae.val(""),re.val(""),se.val(""),te.val(""),ne.val(""),Xe.val(""),ei.val(""),ii.val(""),ti.val(""),ni.val(""),ai.val(""),ri.val(""),si.val(""),oi.val(""),li.val(""),ci.val(""),di.val(""),pi.val(""),a!==lt&&1===fe.length)Ue.dialog("option","title","Update Recipe"),We.hide(),$e.hide(),Ge.show(),ge=!0;else{if(ve=K.getContent(),!Ni&&(I=Li.exec(ve)||Oi.exec(ve)||Mi.exec(ve),I||(r=e("#hasRecipe").is(":checked")),I||r))return r?(Re="recipress",Ee=xe.postID):(Re=I[2],Ee=I[3]),Ye.hide(),Be.click(f),Ve.click(m),p=Fi[Re],C=e("#txtERCNVText1",Pe),C.html(C.html().replace("#plugin#",p)),Fe.html(""),gi=-1,ze=[],Fe.html(ot),Pe.parent(".ui-dialog").css(qi,Oe),Pe.dialog(Ki,qi,Oe),void Pe.dialog(at);xe.isGuest&&(U=e("#inpERAuthor").val()||"",le.val(U)),$e.show(),Ge.hide(),We.show(),Ue.dialog("option","title","Add a New Recipe"),ge=!1,Ce!==!1?P=y(Ce):(k=K.selection.getContent(),k.length>20&&(P=y(k))),P.summary&&(L=P.summary),P.ingredients&&(O=P.ingredients),P.instructions&&(M=P.instructions),P.notes&&(D=P.notes),fe=u()}for(fe.find(".hiddenGrammarError, .hiddenSpellError, .hiddenSuggestion").each(function(){var i;e(this).parent(".mceItemHidden").length>0&&e(this).unwrap(),i=e(this).text(),e(this).replaceWith(i)}),_=fe,fe=e("<div>"+fe.html()+"</div>"),e("#inpERCuisine").autocomplete({source:e.parseJSON(xe.cuisines)}).autocomplete("widget").wrap('<div id="easyrecipeUI" class="easyrecipeUI" />'),e("#inpERType").autocomplete({source:e.parseJSON(xe.recipeTypes)}).autocomplete("widget").wrap('<div id="easyrecipeUI" class="easyrecipeUI" />'),ht=!1,Ii.off("change",t).on("change",t),he=!1,e(".hrecipe",Zi).length>0&&confirm("This post is already hrecipe microformatted\n\nDo you want me to try to convert it to an EasyRecipe?")&&(he=!0),Ei=a!==lt?fe.find(".endeasyrecipe").text():xe.version,""===Ei&&(Ei="2.2"),dt=e('link[itemprop="image"]',fe).attr("href")||"",Fe.html(""),gi=-1,Ri="",ze=[],Zi.find("img").each(function(i){var t=!1;"3">Ei?e(this).hasClass("photo")&&(t=!0):t=this.src===dt,R(this.src,i,t)}),d=Zi.contents().text(),I=Hi.exec(d),N=ze.length;null!==I;)c=zi.exec(I[0]),null!==c&&(l=c[1],R(l,N),Ei>"3"?dt===l&&(ze[N].parent().addClass(rt),gi=N):ji.test(I[0])&&(ze[N].parent().addClass(rt),gi=N,dt=l),N++),I=Hi.exec(d);""!==dt&&w(dt,!0),ye=e("#set-post-thumbnail").find("img").attr("src"),ye&&w(ye,-1===gi),-1===gi&&ze.length>0&&(gi=0,dt=Ri,ze[0].parent().addClass(rt)),Fe.click(function(i){"IMG"===i.target.nodeName&&(e(".ERPhoto",Fe).removeClass(rt),e(i.target).parent().addClass(rt),dt=i.target.src)}),0===ze.length?Fe.html(ot):-1===gi&&ze[0].parent().addClass(rt),Yi=[],Wi=[],x=fe.find(".ERName .fn").html()||fe.find(".ERName").html(),ee.val(x&&""!==x?o(n(x)):o(n(e("#title").val()))),ce.val(o(n(fe.find(".type").html()))),le.val(o(n(fe.find(".author").html()))),""===le.val()&&le.val(o(e.parseJSON(xe.author))),de.val(o(n(fe.find(".cuisine").html()))),ie.val(o(L+n(fe.find(".summary").html()))),Ei>"3"?(T=fe.find('time[itemprop="prepTime"]').html()||"",ae.val(n(T)),T=fe.find('time[itemprop="cookTime"]').html()||"",re.val(n(T))):(T=fe.find(".preptime").html()||"",I=_i.exec(T),ae.val(null!==I?n(I[1]):""),T=fe.find(".cooktime").html()||"",I=_i.exec(T),re.val(null!==I?n(I[1]):"")),se.val(n(fe.find(".yield").html())),fe.find(".ingredients li").each(function(i,t){O+=e(t).hasClass(Qi)?"!"+o(n(t.innerHTML))+"\n":o(n(t.innerHTML))+"\n"}),te.val(O),fe.find(".instructions li, .instructions .ERSeparator").each(function(i,t){b=e.trim(t.innerHTML.replace(/^[ 0-9.]*(.*)$/gi,"$1")),M+=e(t).hasClass(Qi)?"!"+b+"\n":b+"\n"}),ne.val(o(n(M))),Xe.val(n(fe.find(".servingSize").html())),ei.val(n(fe.find(".calories").html())),ii.val(n(fe.find(".fat").html())),ti.val(n(fe.find(".saturatedFat").html())),ni.val(n(fe.find(".unsaturatedFat").html())),ai.val(n(fe.find(".transFat").html())),ri.val(n(fe.find(".carbohydrates").html())),si.val(n(fe.find(".sugar").html())),oi.val(n(fe.find(".sodium").html())),li.val(n(fe.find(".fiber").html())),ci.val(n(fe.find(".protein").html())),di.val(n(fe.find(".cholesterol").html())),A=_.parent().prop("data-rating"),X.val(e.isNumeric(A)?A:"5"),b=(n(fe.find(".ERNotes").html())||"").replace(/<\/p>\n*<p>/gi,"\n\n").replace(/(?:<p>|<\/p>)/gi,"").replace(/<br *\/?>/gi,"\n"),""===b&&""!==D&&(b=D),b=o(b),b=b.replace(/\[br(?: ?\/)?]/gi,"\n"),pi.val(o(b)),Ci&&(Ci.name&&ee.val(o(n(Ci.name))),Ci.author&&le.val(o(Ci.author)),Ci.summary&&ie.val(o(Ci.summary)),Ci["yield"]&&se.val(n(Ci["yield"])),Ci.type&&ce.val(o(n(Ci.type))),Ci.cuisine&&de.val(o(n(Ci.cuisine))),Ci.prepTime&&ae.val(n(Ci.prepTime)),Ci.cookTime&&re.val(n(Ci.cookTime)),Ci.summary&&ie.val(o(Ci.summary))),fe=_,Ue.parent(".ui-dialog").css(qi,Oe),Ue.dialog(Ki,qi,Oe),Ue.dialog(at),Ue.dialog("option","position","center")}}function I(i){return Xi=e(".easyrecipe",Zi).length,et||0===Xi?void C(i,lt):(_e.parent(".ui-dialog").css(qi,Oe),_e.dialog(Ki,qi,Oe),void _e.dialog(at))}function T(){Ue.dialog(it)}function S(){Ae.dialog(it)}function N(){var e=confirm("Are you sure you want to delete this recipe?");e&&(fe.remove(),fe=!1,ht=!1),Ue.dialog(it)}function x(){var i,t=e("#inpERPaste"),n=t.val();i=y(n),(0!==i.ingredients.length||0!==i.instructions.length)&&(Ce=n,t.val(""),Ci={name:l(a(ee.val())),author:l(r(le)),"yield":r(se),type:l(r(ce)),cuisine:l(r(de)),summary:l(r(ie)),servesize:r(Xe),prepTime:ae.val(),cookTime:re.val()},ht=!1,Ue.dialog(it),I(null))}function k(i){var t=e(i.target).parent(),n=t.parent();t.hasClass("easyrecipeAbove")?n.before(pt):n.after(pt),t.remove(),U()}function U(){var i,t,n;t=e("<div>"+K.getContent()+"</div>"),t.find(".easyrecipeAbove,.easyrecipeBelow").remove(),i=t.find(".easyrecipe"),i.each(function(){var i=e(this);i.parent().hasClass("easyrecipeWrapper")&&i.unwrap(),bi(i)}),n=t.html(),K.setContent(n),i=Zi.find(".easyrecipe"),i.on("mousedown",null,ct,C),Zi.find(".ERInsertLine").on(tt,k)}function _(e){var i,t,n,a,r;if(a=e.prev(),r=e.next(),t=0===a.length||a.hasClass("easyrecipe")||a.hasClass("easyrecipeWrapper"))try{t=!(e[0].previousSibling&&3===e[0].previousSibling.nodeType)}catch(s){}if(n=0===r.length||r.hasClass("easyrecipe")||r.hasClass("easyrecipeWrapper"))try{n=!(e[0].nextSibling&&3===e[0].nextSibling.nodeType)}catch(s){}(t||n)&&(e.wrap('<div class="easyrecipeWrapper mceNonEditable" />'),i=e.parent(),t&&(i.prepend('<div class="easyrecipeAbove mceNonEditable"><input class="ERInsertLine mceNonEditable" type="button" value="Insert line above" /></div>'),i.find("input").on(tt,k),ut.push(i.find(".easyrecipeAbove")[0])),n&&(i.append('<div class="easyrecipeBelow mceNonEditable"><input class="ERInsertLine mceNonEditable" type="button" value="Insert line below" /></div>'),i.find("input").on(tt,k)))}function A(i){e(".easyrecipeAbove,.easyrecipeBelow",i).remove(),e(".easyrecipe",i).unwrap()}function P(){var i=e(".easyrecipe",Zi);0!==i.length&&(i.on("mousedown",null,ct,C),U())}function L(){var i,t,n,s,o,p,u,h,v,f,g,m,y,E,R="",b="",w=0,C="",I=[];if(d(ae)&&d(re)){for(t=e.trim(ae.val()),""!==t?(Me=Ai.exec(t),n=Me[1]?parseInt(Me[1],10):0,s=Me[2]?parseInt(Me[2],10):0,w=60*n+s,o=n>0?n+"H":"",p=s>0?s+"M":"",b="PT"+o+p):t=!1,i=e.trim(re.val()),""!==i?(Me=Ai.exec(i),n=Me[1]?parseInt(Me[1],10):0,s=Me[2]?parseInt(Me[2],10):0,o=n>0?n+"H":"",p=s>0?s+"M":"",w+=60*n+s,R="PT"+o+p):i=!1,w>0?(n=Math.floor(w/60),s=w%60,o=n>0?n+" hour":"",n>1&&(o+="s"),p=s>0?s+" min":"",s>1&&(p+="s"),w=e.trim(o+" "+p),o=n>0?n+"H":"",p=s>0?s+"M":"",C="PT"+o+p):w=!1,u=te.val().split("\n"),v=0;v<u.length;v++)h=u[v],""!==h&&("!"===h.charAt(0)?(f=!0,h=h.substr(1)):f=!1,I.push({ingredient:l(a(h)),hasHeading:f}));for(u=ne.val().split("\n"),m=[],g={INSTRUCTIONS:[]},v=0;v<u.length;v++)h=e.trim(u[v].replace(/^[ 0-9\.]*(.*)$/gi,"$1")),""!==h&&("!"===h.charAt(0)?((g.INSTRUCTIONS.length>0||g.heading)&&m.push(g),h=h.substr(1),g={},g.INSTRUCTIONS=[],g.heading=l(a(h))):g.INSTRUCTIONS.push({instruction:l(a(h))}));(g.INSTRUCTIONS.length>0||g.heading)&&m.push(g),h=r(pi),h&&(h=h.replace(/\n/g,"[br]")),y={version:xe.version,hasPhoto:""!==dt,photoURL:dt,name:l(a(ee.val())),author:l(r(le)),preptime:t,cooktime:i,totaltime:w,preptimeISO:b,cooktimeISO:R,totaltimeISO:C,"yield":r(se),type:l(r(ce)),cuisine:l(r(de)),summary:l(r(ie)),servesize:r(Xe),calories:r(ei),fat:r(ii),satfat:r(ti),unsatfat:r(ni),transfat:r(ai),carbs:r(ri),sugar:r(si),sodium:r(oi),fiber:r(li),protein:r(ci),cholesterol:r(di),notes:l(h),rating:X.length?X.val():"0",INGREDIENTS:I,STEPS:m},""===y.name&&(y.name=!1),E=c(xe.recipeTemplate,y),he&&e(".hrecipe",Zi).remove(),-1===hi?fe=e(Ji,Zi):(fe=e(".easyrecipe",Zi),fe.length>0&&(fe=e(fe[hi]))),fe.before(E),fe.remove(),fe=!1,ui.show(),ht=!1,Ue.dialog(it),Xi=e(".easyrecipe",Zi).length,P()}}function O(i,t){var n,a,r;if(Ci=!1,tinymce.majorVersion>"3"){if(t.id!==oe&&"wp_mce_fullscreen"!==t.id)return e("#"+t.controlManager.buttons.easyrecipeTest._id).hide(),e("#"+t.controlManager.buttons.easyrecipeEdit._id).hide(),void e("#"+t.controlManager.buttons.easyrecipeAdd._id).hide();t.id===oe?(Zi=e("#"+oe+"_ifr").contents(),Oe=1e4,a=e("#"+t.controlManager.buttons.easyrecipeTest._id),ui=e("#"+t.controlManager.buttons.easyrecipeEdit._id)):(Zi=e("#wp_mce_fullscreen_ifr").contents(),Oe=200001,a=e("#mce_fullscreen_easyrecipeTest"),ui=e("#mce_fullscreen_easyrecipeEdit"))}else{if(t.editorId!==oe&&"wp_mce_fullscreen"!==t.editorId)return e("#"+t.editorId+"_easyrecipeTest").hide(),e("#"+t.editorId+"_easyrecipeEdit").hide(),void e("#"+t.editorId+"_easyrecipeAdd").hide();t.editorId===oe?(Zi=e("#"+oe+"_ifr").contents(),Oe=1e4,a=e("#"+oe+"_easyrecipeTest"),ui=e("#"+oe+"_easyrecipeEdit")):(Zi=e("#wp_mce_fullscreen_ifr").contents(),Oe=200001,a=e("#mce_fullscreen_easyrecipeTest"),ui=e("#mce_fullscreen_easyrecipeEdit"))}Le=e("body",Zi),r=e(".easyrecipe",Zi),K=tinyMCE.activeEditor,r.each(function(){e(this).addClass("mceNonEditable"),e(".ERRatingOuter",this).remove(),e(".ERHDPrint",this).remove(),e(".ERLinkback",this).remove()}),Xi=r.length,Xi>0&&""!==xe.testURL?a.show():a.hide(),Xi>0?ui.show():ui.hide(),Zi.hasERCSS||(n=xe.isDebug?"":"-min",e("head",Zi).append('<link rel="stylesheet" type="text/css" href="'+xe.easyrecipeURL+"/css/easyrecipe-entry"+n+".css?ver="+xe.version+'" />'),Zi.hasERCSS=!0),P()}function M(){Qe.toggleClass("ERNone"),Ze.toggleClass("ERContract")}function D(){Ke.toggleClass("ERNone"),qe.toggleClass("ERContract")}function H(i){var t,n,a,r,s,o;xe.isEntryDialog&&(t=e("#ertmp_"+$i,Zi),"string"==typeof i?a=e(i):(o=t.html(),a="link"===o?t.parent("a"):e(t.html())),a.is("a")&&(n=a.attr("href"),r=a.attr("title"),s=a.attr("target"),r=r?' title="'+r+'"':"",s=s?' target="'+s+'"':"",i='href="'+n+'"'+s+r,Wi.push(i),Ne.val(Se.substring(0,Ie)+"[url:"+Wi.length+"]"+Se.substring(Ie,Te)+"[/url]"+Se.substring(Te))),Ne[0].focus(),Le.find(".erdeleteme").remove())}function j(e,i){var t,n,a,r,s,o;n=e.sizes[i.size],a=n.url,s=n.width,o=n.height,R(a,ze.length),t=Se.substring(0,Ie),Yi.push('src="'+a+'" width="'+s+'" height="'+o+'"class="align'+i.align+'"'),"none"===i.link?t+="[img:"+Yi.length+"]":("file"===i.link?r=a:"post"===i.link?r=e.link:"custom"===i.link&&(r=i.linkUrl),Wi.push('href="'+r+'"'),t+="[url:"+Wi.length+"][img:"+Yi.length+"][/url]"),t+=Se.substring(Te),Ne.val(t),Ne[0].focus()}function z(){var e;Ti||(Ti=wp.media({title:"Select Image",multiple:!1,library:{type:"image"},button:{text:"add image"}}),Ti.on("content:create:browse",function(i){e=i.view,i.view.options.display=!0}),Ti.on("select",function(){var i=Ti.state().get("selection"),t=e.sidebar.get("display").model.attributes,n=i.models[0].attributes;j(n,t)}),Ti.$el.addClass("ui-dialog")),Ti.open()}function F(){var i,t,n,a=!1;if(Vi){if(Vi.focus(),Ie=Vi[0].selectionStart,Te=Vi[0].selectionEnd,Se=Vi.val(),t=e(this),t.hasClass("ERIconBold")?(a="[b]",n="[/b]"):t.hasClass("ERIconUnderline")?(a="[u]",n="[/u]"):t.hasClass("ERIconItalic")?(a="[i]",n="[/i]"):t.hasClass("ERIconLineBreak")&&(a="[br]",n=""),a)return(Ie!==Te||""===n)&&Vi.val(Se.substring(0,Ie)+a+Se.substring(Ie,Te)+n+Se.substring(Te)),void Vi[0].focus();if(t.hasClass("ERIconImage")&&(Ne=Vi,z()),t.hasClass("ERIconLink")){if(Ie===Te)return;Ne=Vi,$i++,i=e('<div class="erdeleteme" id="ertmp_'+$i+'">link</div>'),i.appendTo(Le),K.selection.select(i[0].firstChild),K.nodeChanged(),xe.isGuest?xe.doLink():K.execCommand("WP_Link",!1)}}}function W(){Ci=!1,I()}function Y(){Ci=!1,C()}function B(){Xi>0&&!xe.noHTMLWarn&&(xe.noHTMLWarn=!0,ke.parent(".ui-dialog").css(qi,Oe),ke.dialog(Ki,qi,Oe),ke.dialog(at))}function V(i){var t,n,a,r,s=e("#wp-preview",i.target).val();return"dopreview"===s?!0:0===Xi?!0:(a=tinyMCE.activeEditor&&!tinyMCE.activeEditor.isHidden(),a?n=e("<div>"+K.getContent()+"</div>"):(r=e("#wp-content-editor-container").find("textarea"),n=e("<div>"+r.val()+"</div>")),A(e(".easyrecipeWrapper",n)),e(".easyrecipe",n).removeClass("mceNonEditable"),t=e.trim(n.html()),a?K.setContent(t):r.val(t),!0)}function $(i){var t,n,a,r,s,o,l,c,d;d=e("#easyrecipe-snippet").find(".ERRSP"),l=d.find(".ERRSPStatus");try{o=e.parseJSON(i)}catch(p){l.text("No snippet data returned from Google"),l.css("color","#f99")}s=e(o.html),c=s.find("#ires .vsc"),0===c.length&&(c=s.find("#ires .rc")),0===c.length?(l.text("No snippet data returned from Google"),l.css("color","#f99")):(a=c.find("h3.r").text(),r=c.find(".s").html(),n=d.find(".ERRSPResult"),t="<h3>"+a+'</h3><div class="s">'+r+"</div>",n.html(t),l.hide(),d.find(".ERRSPResult .f.slp .csb").css("background-image",""))}function G(){}function J(i){e.ajax({url:ajaxurl,type:"POST",data:{action:"easyrecipeSnippet",id:i},success:$,error:G})}function Q(i){var t;""!=i.target.innerHTML&&(t=e(i.target).find("img").attr("src"),t&&w(t,!1))}function Z(i){var t,n,a,r;for(t=i[0],n=0;n<t.addedNodes.length;n++)if(a=e(t.addedNodes[n].innerHTML),r=a.find("img").attr("src")){w(r,!1);break}}var K,q,X,ee,ie,te,ne,ae,re,se,oe,le,ce,de,pe,ue,he,ve,fe,ge,me,ye,Ee,Re,be,we,Ce,Ie,Te,Se,Ne,xe,ke,Ue,_e,Ae,Pe,Le,Oe,Me,De,He,je,ze,Fe,We,Ye,Be,Ve,$e,Ge,Je,Qe,Ze,Ke,qe,Xe,ei,ii,ti,ni,ai,ri,si,oi,li,ci,di,pi,ui,hi,vi,fi,gi,mi,yi,Ei,Ri,bi,wi,Ci,Ii,Ti,Si=jQuery.trim,Ni=!1,xi=/<!-- START INCLUDEIF (!?)([_a-z][_0-9a-z]{0,19}) -->/i,ki=/^#([_a-z][_0-9a-z]{0,19})#/im,Ui=/<!-- START REPEAT ([_a-zA-Z][_0-9a-zA-Z]{0,19}) -->/m,_i=/^([^<]*)/,Ai=/^(?:([0-9]+) *(?:h|hr|hrs|hour|hours))? *(?:([0-9]+) *(?:m|mn|mns|min|mins|minute|minutes))?$/i,Pi=/^([0-9]+)$/,Li=/(.*)\[amd-(recipeseo|zlrecipe)-recipe:([0-9]+)](.*)/,Oi=/(.*)\[(yumprint)-recipe\s+id='(\d+)'](.*)/i,Mi=/(.*)\[(gmc)_recipe\s+([0-9]+)](.*)/,Di=/PT(?:([0-9]*)+H)?([0-9]+)+M/i,Hi=/\[(?:img) +(?:[^\]]+?)]/gi,ji=/class\s*=\s*"(?:[^"]+ )?photo[ "]/i,zi=/src\s*=\s*" *([^"]+?) *"/i,Fi={recipeseo:"Recipe SEO",ziplist:"ZipList",zlrecipe:"ZipList",yumprint:"Yumprint Recipe Card",recipress:"ReciPress",gmc:"GetMeCooking"},Wi=[],Yi=[],Bi="Switch to the Visual Editor to add or edit an EasyRecipe",Vi=null,$i=0,Gi='<div class="easyrecipeholder">EasyRecipe</div>',Ji=".easyrecipeholder",Qi="ERSeparator",Zi=null,Ki="option",qi="zIndex",Xi=0,et=!0,it="close",tt="click",nt="undefined",at="open",rt="ERPhotoSelected",st="http://www.easyrecipeplugin.com/checkUpdates.php",ot='<div class="divERNoPhotos">There are no photos in this post<br />Add photos anywhere in the post</div>',lt=-1,ct=-2,dt="",pt="&nbsp;",ut=[],ht=!1;e(function(){var t,n,a,r,o,l=null;xe=EASYRECIPE,xe.button!==e.fn.button&&(l=e.fn.button,e.fn.button=xe.button),Ue=e("#easyrecipeEntry"),Ae=e("#easyrecipeSelect"),ke=e("#easyrecipeHTMLWarn"),oe=xe.isGuest?"guestpost":"content",Ae.dialog({autoOpen:!1,width:340,modal:!0,dialogClass:"easyrecipeSelect",close:function(){e(".easyrecipeSelect").filter(function(){return""===e(this).text()}).remove()},open:function(){e(".ui-widget-overlay").wrap('<div id="easyrecipeUI" class="easyrecipeUI" />')}}),e("#divERSELContainer").show(),Ae.parent(".ui-dialog").wrap('<div id="easyrecipeUI" class="easyrecipeUI" />'),Ue.dialog({autoOpen:!1,width:655,modal:!0,dialogClass:"easyrecipeEntry",beforeClose:function(){if(ht){if(!window.confirm("Are you sure you want to close without saving the recipe?"))return!1;ht=!1}return!0},close:function(){xe.isEntryDialog=!1,fe&&!ge&&fe.remove(),fe=!1,e(".easyrecipeEntry").filter(function(){return""===e(this).text()}).remove()},open:function(){xe.isEntryDialog=!0,e(".ui-widget-overlay").wrap('<div id="easyrecipeUI" class="easyrecipeUI" />'),De.tabs({active:0,beforeActivate:i}),setTimeout(function(){var i=e(".easyrecipeEntry"),t=i.offset();t.top<mi&&(t.top=mi,i.offset(t))},250)}}),Ue.parent(".ui-dialog").wrap('<div id="easyrecipeUI" class="easyrecipeUI" />'),Ii=e("#divERContainer").show(),ke.dialog({autoOpen:!1,width:420,modal:!0,dialogClass:"easyrecipeHTMLWarn",close:function(){e(".easyrecipeHTMLWarn").filter(function(){return""===e(this).text()}).remove()},open:function(){e(".ui-widget-overlay").wrap('<div id="easyrecipeUI" class="easyrecipeUI" />')}}),ke.parent(".ui-dialog").wrap('<div id="easyrecipeUI" class="easyrecipeUI" />'),e(".divERHTMLWarnContainer").show(),Pe=e("#easyrecipeConvert"),Ye=e("#divERCNVSpinner"),Be=e("#btnERCNVCancel"),Ve=e("#btnERCNVOK"),Ye.hide(),Pe.dialog({autoOpen:!1,width:390,modal:!0,dialogClass:"easyrecipeConvert",close:function(){e(".easyrecipeConvert").filter(function(){return""===e(this).text()}).remove()},open:function(){e(".ui-widget-overlay").wrap('<div id="easyrecipeUI" class="easyrecipeUI" />')}}),e("#divERCNVContainer").show(),Pe.parent(".ui-dialog").wrap('<div id="easyrecipeUI" class="easyrecipeUI" />'),e(window).bind("easyrecipeadd",W),e(window).bind("easyrecipeedit",Y),e(window).bind("easyrecipeload",O),e(window).bind("easyrecipeimage",j),e(window).bind("easyrecipeguestimageuploaded",j),je=e("#divERNext"),He=e("#btnERButtons"),De=e("#ERDTabs"),Fe=e("#divERPhotos"),e("input:submit",".easyrecipeUI").button(),me=e("#ed_toolbar"),X=e("#inpERRating"),ee=e("#inpERName"),le=e("#inpERAuthor"),ce=e("#inpERType"),de=e("#inpERCuisine"),pe=e("#inpERTags"),ie=e("textarea#taERSummary"),te=e("textarea#taERIngredients"),ne=e("textarea#taERInstructions"),ae=e("#inpERPrepTime"),re=e("#inpERCookTime"),se=e("#inpERYield"),Xe=e("#inpERServeSize"),ei=e("#inpERCalories"),ii=e("#inpERFat"),ti=e("#inpERSatFat"),ni=e("#inpERUnsatFat"),ai=e("#inpERTransFat"),ri=e("#inpERCarbs"),si=e("#inpERSugar"),oi=e("#inpERSodium"),li=e("#inpERFiber"),ci=e("#inpERProtein"),di=e("#inpERCholesterol"),pi=e("textarea#taERNotes"),vi=e("#divERAddImageURL"),o=e("#lnkERPhotoURL"),ue=e(".ERTimeError"),$e=e("#divERAdd"),Ge=e("#divERChange"),Je=e("#divERHeader"),Qe=e("#divEROther"),Ze=e("#divEROtherLabel"),Ke=e("#divERNotes"),qe=e("#divERNotesLabel"),We=e("#ERDPasteTab"),fi=e("#fldERAPUImageURL"),e("#btnERAdd").click(L),e("#btnERNext").click(s),e("#btnERChange").click(L),e("#btnERDelete").click(N),e("#btnERCancel").click(T),o.click(function(){vi.show(500)}),e("#btnERAIUCancel").click(function(){vi.hide()}),e("#btnERAIUOK").click(b),Ze.click(M),qe.click(D),ae.change(function(i){d(e(i.target))}),re.change(function(i){d(e(i.target))}),e("#btnERPaste").click(x),e("#btnERSELCancel").click(S),mi=e("#wpadminbar").height(),yi=e("#divEREditBtns").on("mousedown","li",F),Ii.find('input[type="text"], textarea').on("blur",function(){Vi=null}).on("focus",function(){Vi=e(this)}),e("#wp-link").bind("wpdialogclose",H),be=I,we=C,Ce=!1,xe.insertUploadedImage=j,bi=_,wi=R,xe.addListener=P,ke.find("input").on(tt,function(){ke.dialog(it)}),e("#wp-content-editor-tools").on(tt,"#content-html",B),e("#post").on("submit",V),null!==l&&(e.fn.button=l),a=e("#easyrecipe-snippet"),"none"!==a.css("display")&&(r=a.find(".ERRSPStatus").attr("postid"),r&&J(r)),t=e("#postimagediv").find(".inside"),window.MutationObserver&&t.length>0?(n=new MutationObserver(Z),n.observe(t[0],{childList:!0})):t.on("DOMSubtreeModified",Q),window.QTags&&QTags.addButton("easyrecipe","EasyRecipe",function(){alert(Bi)},"","","",900)})}(jQuery);